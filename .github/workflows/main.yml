name: IP File Distribution

on:
  workflow_dispatch:  # Manual execution via GitHub interface
  schedule:
    - cron: '0 * * * *'  # Automatically triggered every hour

jobs:
  send-files:
    runs-on: ubuntu-latest

    env:
      CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      EXPORT_URL: "https://raw.githubusercontent.com/Json-Script/Collect_IPs/main/list/export.json"
      IPV4_URL: "https://raw.githubusercontent.com/Json-Script/Collect_IPs/main/list/ipv4.json"
      IPV6_URL: "https://raw.githubusercontent.com/Json-Script/Collect_IPs/main/list/ipv6.json"
      FULL_URL: "https://raw.githubusercontent.com/Json-Script/Collect_Keys/main/plus/full"
      LITE_URL: "https://raw.githubusercontent.com/Json-Script/Collect_Keys/main/plus/lite"

    steps:
      # Step 1: Initialize the repository
      - name: Initialize Repository
        uses: actions/checkout@v3  # Use the latest stable version

      # Step 2: Download Files
      - name: Download Files
        run: |
          curl --retry 3 -o export.json $EXPORT_URL
          curl --retry 3 -o ipv4.json $IPV4_URL
          curl --retry 3 -o ipv6.json $IPV6_URL
          curl --retry 3 -o full $FULL_URL
          curl --retry 3 -o lite $LITE_URL

      # Step 3: Send Files to Telegram
      - name: Send Files to Telegram
        run: |
          for file in export.json ipv4.json ipv6.json full lite; do
            # Set the caption based on the file name
            case $file in
              export.json)
                caption="üìÇ Export Data File: Comprehensive dataset for analysis." ;;
              ipv4.json)
                caption="üåê IPv4 Addresses: Curated registry of IPv4 addresses." ;;
              ipv6.json)
                caption="üåç IPv6 Addresses: Extensive collection of IPv6 addresses." ;;
              full)
                caption="üìã Full File: Detailed data file for broad analysis." ;;
              lite)
                caption="üìë Lite File: Streamlined dataset for focused analysis." ;;
            esac

            # Send the file to Telegram
            curl --retry 3 -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendDocument" \
              -F chat_id="$CHAT_ID" \
              -F document=@$file \
              -F caption="$caption"
          done